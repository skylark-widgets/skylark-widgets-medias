/**
 * skylark-widgets-medias - The skylark media widgets library
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-medias/
 * @license MIT
 */
!function(t,e){var i=e.define,require=e.require,s="function"==typeof i&&i.amd,o=!s&&"undefined"!=typeof exports;if(!s&&!i){var r={};i=e.define=function(t,e,i){"function"==typeof i?(r[t]={factory:i,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var i=e.split("/"),s=t.split("/");i.pop();for(var o=0;o<s.length;o++)"."!=s[o]&&(".."==s[o]?i.pop():i.push(s[o]));return i.join("/")}(e,t)}),resolved:!1,exports:null},require(t)):r[t]={factory:null,resolved:!0,exports:i}},require=e.require=function(t){if(!r.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var module=r[t];if(!module.resolved){var i=[];module.deps.forEach(function(t){i.push(require(t))}),module.exports=module.factory.apply(e,i)||null,module.resolved=!0}return module.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,require){t("skylark-widgets-medias/medias",["skylark-langx/skylark"],function(t){return t.attach("widgets.medias",{})}),t("skylark-widgets-medias/audio-player",["skylark-domx-eventer","skylark-widgets-base/widget","./medias"],function(t,e,i){"use strict";var s,o={getContext:function(){return void 0===s&&(s=new(window.AudioContext||window.webkitAudioContext)),s},setContext:function(t){s=t}},r=e.inherit({_construct:function(i){e.prototype._construct.call(this,i,"div"),this._elm.style.overflow="visible";var s=this;this.context=o.getContext(),this.timer=document.createElement("div"),this.timer.style.position="absolute",this.timer.style.display="flex",this.timer.style.justifyContent="center",this.timer.style.alignItems="center",this.timer.style.width="40px",this.timer.style.height="100%",this.timer.style.right="0px",this._elm.appendChild(this.timer),this.timerText=document.createTextNode("00:00"),this.timer.appendChild(this.timerText),this.button=document.createElement("button"),this.button.style.position="absolute",this.button.style.cursor="pointer",this.button.style.background="transparent",this.button.style.border="none",this.button.style.outline="none",this._elm.appendChild(this.button),this.button.onclick=function(){s.toggle()},this.icon=document.createElement("img"),this.icon.style.position="absolute",this.icon.style.left="15%",this.icon.style.top="15%",this.icon.style.width="70%",this.icon.style.height="70%",this.icon.src=Global.FILE_PATH+"icons/misc/play.png",this.button.appendChild(this.icon),this.track=document.createElement("div"),this.track.style.position="absolute",this.track.style.backgroundColor=Editor.theme.audioTrack,this.track.style.cursor="pointer",this._elm.appendChild(this.track),this.progress=document.createElement("div"),this.progress.style.pointerEvents="none",this.progress.style.position="absolute",this.progress.style.backgroundColor=Editor.theme.audioProgress,this.progress.style.height="100%",this.track.appendChild(this.progress),this.scrubber=document.createElement("div"),this.scrubber.style.position="absolute",this.scrubber.style.backgroundColor=Editor.theme.audioScrubber,this.scrubber.style.cursor="pointer",this.scrubber.style.width="6px",this.track.appendChild(this.scrubber),this.buffer=null,this.source=null,this.time=0,this.startTime=0,this.playing=!1,this.loop=!1,this.seekStart=0,this.seekTime=0,this.seekProgress=0,this.dragging=!1,t.on(window,"mousemove",function(t){s.seekProgress=(t.pageX-s.seekStart)/s.track.offsetWidth,s.seekProgress+=s.seekTime/s.buffer.duration,s.seekProgress<0?s.seekProgress=0:s.seekProgress>1&&(s.seekProgress=1),s.progress.style.width=100*s.seekProgress+"%",s.scrubber.style.left=s.progress.style.width}),t.on(window,"mouseup",function(t){s.dragging=!1,s.time=s.seekProgress*s.buffer.duration,s.playing&&s.play(s.time)}),this.scrubber.onmousedown=function(t){s.seekStart=t.pageX,s.seekTime=s.time,s.dragging=!0,s.manager.create(),t.stopPropagation()},this.track.onmousedown=function(t){var e=t.layerX/this.offsetWidth;s.seekProgress=e,s.time=e*s.buffer.duration,s.progress.style.width=100*s.seekProgress+"%",s.scrubber.style.left=s.progress.style.width,s.playing&&s.play(s.time),s.scrubber.onmousedown(t)},function t(){if(s.playing){s.time=s.context.currentTime-s.startTime;var e=Math.round(s.time%60);e<10&&(e="0"+e);var i=Math.round(s.time/60);if(i<10&&(i="0"+i),s.timerText.data=i+":"+e,null!==s.buffer){s.time>=s.buffer.duration&&s.stop();var o=s.time/s.buffer.duration*100;s.dragging||(s.progress.style.width=o+"%",s.scrubber.style.left=o+"%")}}null!==s.parent&&requestAnimationFrame(t)}()},setAudioBuffer:function(t,e){var i=this;this.context.decodeAudioData(t.slice(0),function(t){i.buffer=t,void 0!==e&&e(t)}.bind(this))},connect:function(){this.playing&&this.pause(),this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.context.destination)},disconnect:function(){this.source.disconnect()},play:function(t){this.connect(),void 0!==t&&(this.time=t),this.source.loop=this.loop,this.startTime=this.context.currentTime-this.time,this.source.start(this.context.currentTime,this.time),this.playing=!0,this.icon.src=Global.FILE_PATH+"icons/misc/pause.png"},pause:function(){this.playing&&(this.playing=!1,this.source.stop(),this.time=this.context.currentTime-this.startTime,this.icon.src=Global.FILE_PATH+"icons/misc/play.png")},stop:function(){this.playing&&(this.source.stop(),this.time=0,this.playing=!1,this.icon.src=Global.FILE_PATH+"icons/misc/play.png")},seek:function(t){this.playing?this.play(t):this.time=t},toggle:function(){this.playing?this.pause():this.play()},destroy:function(){try{this.disconnect(),this.stop()}catch(t){}e.prototype.destroy.call(this)},_updateSize:function(){e.prototype._updateSize.call(this),this.button.style.width=this._elm.style.height,this.button.style.height=this._elm.style.height,this.track.style.top=.25*this.size.y+"px",this.track.style.left=1.05*this.size.y+"px",this.track.style.width=this.size.x-1.5*this.size.y-35+"px",this.track.style.height=.5*this.size.y+"px",this.scrubber.style.height=.8*this.size.y+"px",this.scrubber.style.top=.15*-this.size.y+"px"}});return i.AudioPlayer=r}),t("skylark-widgets-medias/media",["skylark-widgets-base/widget","./medias"],function(t,e){"use strict";var i=t.inherit({_construct:function(e,i){t.prototype._construct.call(this,e,"div"),this.media=document.createElement(i),this._elm.appendChild(this.media)},setVolume:function(t){this.media.volume=t},setValue:function(t){this.media.src=t.data},setURL:function(t){this.media.src=t},setTime:function(t){this.media.currentTime=t},setAutoplay:function(t){this.media.autoplay=t},isPlaying:function(t){return!this.media.paused},setLoop:function(t){this.media.loop=t},setPlaybackRate:function(t){this.media.playbackRate=t},play:function(){this.media.play()},stop:function(){this.media.currentTime=0,this.media.pause()},pause:function(){this.media.pause()},_updateSize:function(){t.prototype._updateSize.call(this),this.media.style.width=this.size.x+"px",this.media.style.height=this.size.y+"px"}});return e.Media=i}),t("skylark-widgets-medias/video-player",["./medias","./media"],function(t,e){"use strict";var i=e.inherit({_construct:function(t){e.prototype._construct.call(this,t,"video"),this.media.playbackRate=1,this.media.loop=!0,this.media.volume=0,this.media.autoplay=!0}});return t.VideoPlayer=i}),t("skylark-widgets-medias/main",["./medias","./audio-player","./video-player"],function(t){return t}),t("skylark-widgets-medias",["skylark-widgets-medias/main"],function(t){return t})}(i),!s){var n=require("skylark-langx-ns");o?module.exports=n:e.skylarkjs=n}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-widgets-medias.js.map
