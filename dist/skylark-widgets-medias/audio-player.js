/**
 * skylark-widgets-medias - The skylark media widgets library
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-medias/
 * @license MIT
 */
define(["skylark-domx-eventer","skylark-widgets-base/widget","./medias"],function(t,e,s){"use strict";var i,o=function(){return void 0===i&&(i=new(window.AudioContext||window.webkitAudioContext)),i},r=e.inherit({_construct:function(s){e.prototype._construct.call(this,s,"div"),this._elm.style.overflow="visible";var i=this;this.context=o(),this.timer=document.createElement("div"),this.timer.style.position="absolute",this.timer.style.display="flex",this.timer.style.justifyContent="center",this.timer.style.alignItems="center",this.timer.style.width="40px",this.timer.style.height="100%",this.timer.style.right="0px",this._elm.appendChild(this.timer),this.timerText=document.createTextNode("00:00"),this.timer.appendChild(this.timerText),this.button=document.createElement("button"),this.button.style.position="absolute",this.button.style.cursor="pointer",this.button.style.background="transparent",this.button.style.border="none",this.button.style.outline="none",this._elm.appendChild(this.button),this.button.onclick=function(){i.toggle()},this.icon=document.createElement("img"),this.icon.style.position="absolute",this.icon.style.left="15%",this.icon.style.top="15%",this.icon.style.width="70%",this.icon.style.height="70%",this.icon.src=Global.FILE_PATH+"icons/misc/play.png",this.button.appendChild(this.icon),this.track=document.createElement("div"),this.track.style.position="absolute",this.track.style.backgroundColor=Editor.theme.audioTrack,this.track.style.cursor="pointer",this._elm.appendChild(this.track),this.progress=document.createElement("div"),this.progress.style.pointerEvents="none",this.progress.style.position="absolute",this.progress.style.backgroundColor=Editor.theme.audioProgress,this.progress.style.height="100%",this.track.appendChild(this.progress),this.scrubber=document.createElement("div"),this.scrubber.style.position="absolute",this.scrubber.style.backgroundColor=Editor.theme.audioScrubber,this.scrubber.style.cursor="pointer",this.scrubber.style.width="6px",this.track.appendChild(this.scrubber),this.buffer=null,this.source=null,this.time=0,this.startTime=0,this.playing=!1,this.loop=!1,this.seekStart=0,this.seekTime=0,this.seekProgress=0,this.dragging=!1,t.on(window,"mousemove",function(t){i.seekProgress=(t.pageX-i.seekStart)/i.track.offsetWidth,i.seekProgress+=i.seekTime/i.buffer.duration,i.seekProgress<0?i.seekProgress=0:i.seekProgress>1&&(i.seekProgress=1),i.progress.style.width=100*i.seekProgress+"%",i.scrubber.style.left=i.progress.style.width}),t.on(window,"mouseup",function(t){i.dragging=!1,i.time=i.seekProgress*i.buffer.duration,i.playing&&i.play(i.time)}),this.scrubber.onmousedown=function(t){i.seekStart=t.pageX,i.seekTime=i.time,i.dragging=!0,i.manager.create(),t.stopPropagation()},this.track.onmousedown=function(t){var e=t.layerX/this.offsetWidth;i.seekProgress=e,i.time=e*i.buffer.duration,i.progress.style.width=100*i.seekProgress+"%",i.scrubber.style.left=i.progress.style.width,i.playing&&i.play(i.time),i.scrubber.onmousedown(t)},function t(){if(i.playing){i.time=i.context.currentTime-i.startTime;var e=Math.round(i.time%60);e<10&&(e="0"+e);var s=Math.round(i.time/60);if(s<10&&(s="0"+s),i.timerText.data=s+":"+e,null!==i.buffer){i.time>=i.buffer.duration&&i.stop();var o=i.time/i.buffer.duration*100;i.dragging||(i.progress.style.width=o+"%",i.scrubber.style.left=o+"%")}}null!==i.parent&&requestAnimationFrame(t)}()},setAudioBuffer:function(t,e){var s=this;this.context.decodeAudioData(t.slice(0),function(t){s.buffer=t,void 0!==e&&e(t)}.bind(this))},connect:function(){this.playing&&this.pause(),this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.connect(this.context.destination)},disconnect:function(){this.source.disconnect()},play:function(t){this.connect(),void 0!==t&&(this.time=t),this.source.loop=this.loop,this.startTime=this.context.currentTime-this.time,this.source.start(this.context.currentTime,this.time),this.playing=!0,this.icon.src=Global.FILE_PATH+"icons/misc/pause.png"},pause:function(){this.playing&&(this.playing=!1,this.source.stop(),this.time=this.context.currentTime-this.startTime,this.icon.src=Global.FILE_PATH+"icons/misc/play.png")},stop:function(){this.playing&&(this.source.stop(),this.time=0,this.playing=!1,this.icon.src=Global.FILE_PATH+"icons/misc/play.png")},seek:function(t){this.playing?this.play(t):this.time=t},toggle:function(){this.playing?this.pause():this.play()},destroy:function(){try{this.disconnect(),this.stop()}catch(t){}e.prototype.destroy.call(this)},_updateSize:function(){e.prototype._updateSize.call(this),this.button.style.width=this._elm.style.height,this.button.style.height=this._elm.style.height,this.track.style.top=.25*this.size.y+"px",this.track.style.left=1.05*this.size.y+"px",this.track.style.width=this.size.x-1.5*this.size.y-35+"px",this.track.style.height=.5*this.size.y+"px",this.scrubber.style.height=.8*this.size.y+"px",this.scrubber.style.top=.15*-this.size.y+"px"}});return s.AudioPlayer=r});
//# sourceMappingURL=sourcemaps/audio-player.js.map
