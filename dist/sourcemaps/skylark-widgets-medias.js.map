{"version":3,"sources":["skylark-widgets-medias.js"],"names":["define","skylark","attach","eventer","Widget","medias","_context","AudioContext","getContext","undefined","window","webkitAudioContext","setContext","value","AudioPlayer","inherit","_construct","parent","prototype","call","this","_elm","style","overflow","self","context","timer","document","createElement","position","display","justifyContent","alignItems","width","height","right","appendChild","timerText","createTextNode","button","cursor","background","border","outline","onclick","toggle","icon","left","top","src","Global","FILE_PATH","track","backgroundColor","Editor","theme","audioTrack","progress","pointerEvents","audioProgress","scrubber","audioScrubber","buffer","source","time","startTime","playing","loop","seekStart","seekTime","seekProgress","dragging","on","event","pageX","duration","play","onmousedown","manager","create","stopPropagation","layerX","offsetWidth","draw","currentTime","seconds","Math","round","minutes","data","stop","requestAnimationFrame","setAudioBuffer","onLoad","decodeAudioData","slice","bind","connect","pause","createBufferSource","destination","disconnect","start","seek","destroy","e","_updateSize","size","y","x","Media","type","media","setVolume","volume","setValue","video","setURL","setTime","setAutoplay","autoplay","isPlaying","paused","setLoop","setPlaybackRate","playbackRate","VideoPlayer","main"],"mappings":"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","file":"../skylark-widgets-medias.js","sourcesContent":["define('skylark-widgets-medias/medias',[\r\n\t\"skylark-langx/skylark\"\r\n],function(skylark) {\r\n\tvar medias = {};\r\n\r\n\treturn skylark.attach(\"widgets.medias\",medias);\r\n\r\n});\r\n\r\n\ndefine('skylark-widgets-medias/audio-player',[\r\n\t\"skylark-domx-eventer\",\r\n\t\"skylark-widgets-base/widget\",\r\n\t\"./medias\"\r\n],function(eventer, Widget,medias){\r\n\t\"use strict\";\r\n\r\n\tvar _context;\r\n\r\n\tvar AudioContext = {\r\n\r\n\t\tgetContext: function () {\r\n\r\n\t\t\tif ( _context === undefined ) {\r\n\r\n\t\t\t\t_context = new ( window.AudioContext || window.webkitAudioContext )();\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn _context;\r\n\r\n\t\t},\r\n\r\n\t\tsetContext: function ( value ) {\r\n\r\n\t\t\t_context = value;\r\n\r\n\t\t}\r\n\r\n\t};\r\n\r\n\r\n\tvar AudioPlayer = Widget.inherit({\r\n\r\n\t\t_construct : function (parent){\r\n\t\t\tWidget.prototype._construct.call(this, parent, \"div\");\r\n\r\n\t\t\tthis._elm.style.overflow = \"visible\";\r\n\r\n\t\t\tvar self = this;\r\n\r\n\t\t\t//WebAudio context\r\n\t\t\tthis.context = AudioContext.getContext();\r\n\r\n\t\t\t//Timer\r\n\t\t\tthis.timer = document.createElement(\"div\");\r\n\t\t\tthis.timer.style.position = \"absolute\";\r\n\t\t\tthis.timer.style.display = \"flex\";\r\n\t\t\tthis.timer.style.justifyContent = \"center\";\r\n\t\t\tthis.timer.style.alignItems = \"center\";\r\n\t\t\tthis.timer.style.width = \"40px\";\r\n\t\t\tthis.timer.style.height = \"100%\";\r\n\t\t\tthis.timer.style.right = \"0px\";\r\n\t\t\tthis._elm.appendChild(this.timer);\r\n\r\n\t\t\t//Text\r\n\t\t\tthis.timerText = document.createTextNode(\"00:00\");\r\n\t\t\tthis.timer.appendChild(this.timerText);\r\n\r\n\t\t\t//Button\r\n\t\t\tthis.button = document.createElement(\"button\");\r\n\t\t\tthis.button.style.position = \"absolute\";\r\n\t\t\tthis.button.style.cursor = \"pointer\";\r\n\t\t\tthis.button.style.background = \"transparent\";\r\n\t\t\tthis.button.style.border = \"none\";\r\n\t\t\tthis.button.style.outline = \"none\";\r\n\t\t\tthis._elm.appendChild(this.button);\r\n\t\t\tthis.button.onclick = function() {\r\n\t\t\t\tself.toggle();\r\n\t\t\t};\r\n\r\n\t\t\t//Icon\r\n\t\t\tthis.icon = document.createElement(\"img\");\r\n\t\t\tthis.icon.style.position = \"absolute\";\r\n\t\t\tthis.icon.style.left = \"15%\";\r\n\t\t\tthis.icon.style.top = \"15%\";\r\n\t\t\tthis.icon.style.width = \"70%\";\r\n\t\t\tthis.icon.style.height = \"70%\";\r\n\t\t\tthis.icon.src = Global.FILE_PATH + \"icons/misc/play.png\";\r\n\t\t\tthis.button.appendChild(this.icon);\r\n\r\n\t\t\t//Track\r\n\t\t\tthis.track = document.createElement(\"div\");\r\n\t\t\tthis.track.style.position = \"absolute\";\r\n\t\t\tthis.track.style.backgroundColor = Editor.theme.audioTrack;\r\n\t\t\tthis.track.style.cursor = \"pointer\";\r\n\t\t\tthis._elm.appendChild(this.track);\r\n\r\n\t\t\t//Progress\r\n\t\t\tthis.progress = document.createElement(\"div\");\r\n\t\t\tthis.progress.style.pointerEvents = \"none\";\r\n\t\t\tthis.progress.style.position = \"absolute\";\r\n\t\t\tthis.progress.style.backgroundColor = Editor.theme.audioProgress;\r\n\t\t\tthis.progress.style.height = \"100%\";\r\n\t\t\tthis.track.appendChild(this.progress);\r\n\r\n\t\t\t//Scrubber\r\n\t\t\tthis.scrubber = document.createElement(\"div\");\r\n\t\t\tthis.scrubber.style.position = \"absolute\";\r\n\t\t\tthis.scrubber.style.backgroundColor = Editor.theme.audioScrubber;\r\n\t\t\tthis.scrubber.style.cursor = \"pointer\";\r\n\t\t\tthis.scrubber.style.width = \"6px\";\r\n\t\t\tthis.track.appendChild(this.scrubber);\r\n\r\n\t\t\t//Audio source and buffer\r\n\t\t\tthis.buffer = null;\r\n\t\t\tthis.source = null;\r\n\r\n\t\t\t//Playback control\r\n\t\t\tthis.time = 0;\r\n\t\t\tthis.startTime = 0;\r\n\t\t\tthis.playing = false;\r\n\t\t\tthis.loop = false;\r\n\r\n\t\t\t//Drag control\r\n\t\t\tthis.seekStart = 0;\r\n\t\t\tthis.seekTime = 0;\r\n\t\t\tthis.seekProgress = 0;\r\n\t\t\tthis.dragging = false;\r\n\r\n\t\t\t//Event manager\r\n\t\t\t//this.manager = new EventManager();\r\n\t\t\t//this.manager.add(window, \"mousemove\", function(event)\r\n\t\t\teventer.on(window, \"mousemove\", function(event)\r\n\t\t\t{\r\n\t\t\t\tself.seekProgress = (event.pageX - self.seekStart) / (self.track.offsetWidth);\r\n\t\t\t\tself.seekProgress += self.seekTime / self.buffer.duration;\r\n\r\n\t\t\t\tif(self.seekProgress < 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tself.seekProgress = 0;\r\n\t\t\t\t}\r\n\t\t\t\telse if(self.seekProgress > 1)\r\n\t\t\t\t{\r\n\t\t\t\t\tself.seekProgress = 1;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.progress.style.width = (self.seekProgress * 100) + \"%\";\r\n\t\t\t\tself.scrubber.style.left = self.progress.style.width;\r\n\t\t\t});\r\n\r\n\t\t\t//this.manager.add(window, \"mouseup\", function(event)\r\n\t\t\teventer.on(window, \"mouseup\", function(event)\r\n\t\t\t{\t\r\n\t\t\t\tself.dragging = false;\r\n\t\t\t\tself.time = self.seekProgress * self.buffer.duration;\r\n\r\n\t\t\t\tif(self.playing)\r\n\t\t\t\t{\r\n\t\t\t\t\tself.play(self.time);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t//self.manager.destroy();\r\n\t\t\t});\r\n\r\n\t\t\tthis.scrubber.onmousedown = function(event) {\r\n\t\t\t\tself.seekStart = event.pageX;\r\n\t\t\t\tself.seekTime = self.time;\r\n\t\t\t\tself.dragging = true;\r\n\t\t\t\tself.manager.create();\r\n\r\n\t\t\t\tevent.stopPropagation();\r\n\t\t\t};\r\n\r\n\t\t\tthis.track.onmousedown = function(event) {\r\n\t\t\t\tvar progress = event.layerX / this.offsetWidth;\r\n\r\n\t\t\t\tself.seekProgress = progress;\r\n\t\t\t\tself.time = progress * self.buffer.duration;\r\n\r\n\t\t\t\tself.progress.style.width = (self.seekProgress * 100) + \"%\";\r\n\t\t\t\tself.scrubber.style.left = self.progress.style.width;\r\n\r\n\t\t\t\tif(self.playing)\r\n\t\t\t\t{\r\n\t\t\t\t\tself.play(self.time);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tself.scrubber.onmousedown(event);\r\n\t\t\t};\r\n\r\n\t\t\t//Update elements\r\n\t\t\tfunction draw() {\r\n\t\t\t\tif(self.playing) {\r\n\t\t\t\t\tself.time = self.context.currentTime - self.startTime;\r\n\r\n\t\t\t\t\tvar seconds = Math.round(self.time % 60);\r\n\t\t\t\t\tif(seconds < 10)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tseconds = \"0\" + seconds;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar minutes = Math.round(self.time / 60);\r\n\t\t\t\t\tif(minutes < 10) {\r\n\t\t\t\t\t\tminutes = \"0\" + minutes;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\tself.timerText.data = minutes + \":\" + seconds;\r\n\r\n\t\t\t\t\tif(self.buffer !== null) {\r\n\t\t\t\t\t\tif(self.time >= self.buffer.duration)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tself.stop();\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tvar progress = (self.time / self.buffer.duration) * 100;\r\n\r\n\t\t\t\t\t\tif(!self.dragging)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tself.progress.style.width = progress + \"%\";\r\n\t\t\t\t\t\t\tself.scrubber.style.left = progress + \"%\";\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif(self.parent !== null) {\r\n\t\t\t\t\trequestAnimationFrame(draw);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdraw();\r\n\t\t},\r\n\r\n\t\t//Decode audio\r\n\t\tsetAudioBuffer : function(buffer, onLoad) {\r\n\t\t\tvar self = this;\r\n\r\n\t\t\tthis.context.decodeAudioData(buffer.slice(0), function(buffer) \t{\r\n\t\t\t\tself.buffer = buffer;\r\n\r\n\t\t\t\tif(onLoad !== undefined) {\r\n\t\t\t\t\tonLoad(buffer);\r\n\t\t\t\t}\r\n\t\t\t}.bind(this));\r\n\t\t},\r\n\r\n\t\t//Connect audio source\r\n\t\tconnect : function() {\r\n\t\t\tif(this.playing)\r\n\t\t\t{\r\n\t\t\t\tthis.pause();\r\n\t\t\t}\r\n\r\n\t\t\tthis.source = this.context.createBufferSource();\r\n\t\t\tthis.source.buffer = this.buffer;\r\n\t\t\tthis.source.connect(this.context.destination);\r\n\t\t},\r\n\r\n\t\t//Disconnect source\r\n\t\tdisconnect : function() {\r\n\t\t\tthis.source.disconnect();\r\n\t\t},\r\n\r\n\t\t//Play audio\r\n\t\tplay : function(time){\r\n\t\t\tthis.connect();\r\n\r\n\t\t\tif(time !== undefined)\r\n\t\t\t{\r\n\t\t\t\tthis.time = time;\r\n\t\t\t}\r\n\r\n\t\t\tthis.source.loop = this.loop;\r\n\t\t\tthis.startTime = this.context.currentTime - this.time;\r\n\t\t\tthis.source.start(this.context.currentTime, this.time);\r\n\t\t\tthis.playing = true;\r\n\r\n\t\t\tthis.icon.src = Global.FILE_PATH + \"icons/misc/pause.png\";\r\n\t\t},\r\n\r\n\t\t//Pause audio\r\n\t\tpause : function() \t{\r\n\t\t\tif(this.playing)\r\n\t\t\t{\r\n\t\t\t\tthis.playing = false;\r\n\t\t\t\tthis.source.stop();\r\n\t\t\t\tthis.time = this.context.currentTime - this.startTime;\r\n\r\n\t\t\t\tthis.icon.src = Global.FILE_PATH + \"icons/misc/play.png\";\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t//Stop audio playback\r\n\t\tstop : function() {\t\r\n\t\t\tif(this.playing) {\r\n\t\t\t\tthis.source.stop();\r\n\t\t\t\tthis.time = 0;\r\n\t\t\t\tthis.playing = false;\r\n\r\n\t\t\t\tthis.icon.src = Global.FILE_PATH + \"icons/misc/play.png\";\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t//Seek time\r\n\t\tseek : function(time) {\r\n\t\t\tif(this.playing) {\r\n\t\t\t\tthis.play(time);\r\n\t\t\t} else \t{\r\n\t\t\t\tthis.time = time;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t//Toggle play/pause\r\n\t\ttoggle : function() {\r\n\t\t\tif(!this.playing) {\r\n\t\t\t\tthis.play();\r\n\t\t\t} else {\r\n\t\t\t\tthis.pause();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tdestroy : function() {\r\n\t\t\ttry {\r\n\t\t\t\tthis.disconnect();\r\n\t\t\t\tthis.stop();\r\n\t\t\t}catch(e){}\r\n\r\n\t\t\tWidget.prototype.destroy.call(this);\r\n\t\t},\r\n\r\n\t\t_updateSize : function() {\r\n\t\t\tWidget.prototype._updateSize.call(this);\r\n\r\n\t\t\t//Button\r\n\t\t\tthis.button.style.width = this._elm.style.height;\r\n\t\t\tthis.button.style.height = this._elm.style.height;\r\n\r\n\t\t\t//Track\r\n\t\t\tthis.track.style.top = (this.size.y * 0.25) + \"px\";\r\n\t\t\tthis.track.style.left = (this.size.y * 1.05) + \"px\";\r\n\t\t\tthis.track.style.width = (this.size.x - this.size.y * 1.5 - 35) + \"px\";\r\n\t\t\tthis.track.style.height = (this.size.y * 0.5) + \"px\";\r\n\r\n\t\t\t//Scrubber\r\n\t\t\tthis.scrubber.style.height = (this.size.y * 0.8) + \"px\";\r\n\t\t\tthis.scrubber.style.top = (-this.size.y * 0.15) + \"px\";\r\n\t\t}\r\n\t});\r\n\r\n\r\n\treturn medias.AudioPlayer = AudioPlayer;\r\n\r\n});\ndefine('skylark-widgets-medias/media',[\n\t\"skylark-widgets-base/widget\",\n\t\"./medias\"\n],function(Widget,medias){\n\t\"use strict\";\n\n\t/**\n\t * Media element can be used to play media content.\n\t *\n\t * Should be used as a base for other multimedia elements like audio and video.\n\t *\n\t * @class Media\n\t * @extends {Widget}\n\t * @param {Widget} parent Parent element.\n\t */\n\n\tvar Media = Widget.inherit({\n\n\t\t_construct : function (parent, type){\n\t\t\tWidget.prototype._construct.call(this, parent, \"div\");\n\n\t\t\t//Media\n\t\t\tthis.media = document.createElement(type);\n\t\t\tthis._elm.appendChild(this.media);\n\t\t},\n\n\n\t\t/**\n\t\t * Set element Media volume.\n\t\t * \n\t\t * @method setVolume\n\t\t * @param {Number} volume Volume level from 0 to 1.\n\t\t */\n\t\tsetVolume : function(volume) {\n\t\t\tthis.media.volume = volume;\t\n\t\t},\n\n\t\t/**\n\t\t * Set video to be played.\n\t\t *\n\t\t * @method setValue\n\t\t * @param {Video} value Video resource to play.\n\t\t */\n\t\tsetValue : function(video) {\n\t\t\tthis.media.src = video.data;\n\t\t},\n\n\t\t/**\n\t\t * Set URL of the media to play.\n\t\t *\n\t\t * @method setURL\n\t\t * @param {String} value Media url.\n\t\t */\n\t\tsetURL : function(value){\n\t\t\tthis.media.src = value;\n\t\t},\n\n\t\t/**\n\t\t * Set the playback time.\n\t\t *\n\t\t * @method setTime\n\t\t * @param {Number} time Time to be set.\n\t\t */\n\t\tsetTime : function(time) {\n\t\t\tthis.media.currentTime = time;\n\t\t},\n\n\t\t/**\n\t\t * Set autoplay mode.\n\t\t * \n\t\t * @method setAutoplay\n\t\t * @param {Boolean} value If true the media starts playing automatically.\n\t\t */\n\t\tsetAutoplay : function(value) {\n\t\t\tthis.media.autoplay = value;\n\t\t},\n\n\t\t/**\n\t\t * Check if the media is playing.\n\t\t * \n\t\t * @method isPlaying\n\t\t * @return {Boolean} True if the media is playing.\n\t\t */\n\t\tisPlaying : function(value) {\n\t\t\treturn !this.media.paused;\n\t\t},\n\n\t\t/**\n\t\t * Set loop mode.\n\t\t * \n\t\t * @method setLoop\n\t\t * @param {Boolean} value If true the media plays in loop.\n\t\t */\n\t\tsetLoop : function(value){\n\t\t\tthis.media.loop = value;\n\t\t},\n\n\t\t/**\n\t\t * Set playback rate.\n\t\t * \n\t\t * @method setPlaybackRate\n\t\t * @param {Number} setPlaybackRate The velocity of playback.\n\t\t */\n\t\tsetPlaybackRate : function(playbackRate) {\n\t\t\tthis.media.playbackRate = playbackRate;\n\t\t},\n\n\t\t/**\n\t\t * Play media playback.\n\t\t * \n\t\t * @method play\n\t\t */\n\t\tplay : function() {\n\t\t\tthis.media.play();\n\t\t},\n\n\t\t/**\n\t\t * Stop media playback.\n\t\t * \n\t\t * @method stop\n\t\t */\n\t\tstop : function(){\n\t\t\tthis.media.currentTime = 0;\n\t\t\tthis.media.pause();\n\t\t},\n\n\t\t/**\n\t\t * Pause media.\n\t\t * \n\t\t * @method pause\n\t\t */\n\t\tpause : function(){\n\t\t\tthis.media.pause();\n\t\t},\n\n\t\t_updateSize : function() {\n\t\t\tWidget.prototype._updateSize.call(this);\n\n\t\t\tthis.media.style.width = this.size.x + \"px\";\n\t\t\tthis.media.style.height = this.size.y + \"px\";\n\t\t}\n\t});\n\n\n\treturn medias.Media = Media;\n});\ndefine('skylark-widgets-medias/video-player',[\n\t\"./medias\",\n\t\"./media\"\n],function(medias,media){\n\t\"use strict\";\n\n\t/**\n\t * Video player element, based on the video tag.\n\t *\n\t * @class VideoPlayer\n\t * @extends {Element}\n\t * @param {Element} parent Parent element.\n\t */\n\tvar VideoPlayer = Media.inherit({\n\n\t\t_construct : function (parent){\n\t\t\tMedia.prototype._construct.call(this, parent, \"video\");\n\n\t\t\tthis.media.playbackRate = 1.0;\n\t\t\tthis.media.loop = true;\n\t\t\tthis.media.volume = 0.0;\n\t\t\tthis.media.autoplay = true;\n\t\t}\n\t});\n\n\treturn medias.VideoPlayer = VideoPlayer;\n});\ndefine('skylark-widgets-medias/main',[\r\n\t\"./medias\",\r\n\t\"./audio-player\",\r\n\t\"./video-player\"\r\n],function(medias){\r\n\treturn medias;\r\n});\ndefine('skylark-widgets-medias', ['skylark-widgets-medias/main'], function (main) { return main; });\n\n"]}